name: Docker Build and Deploy

on:
  push:
    branches:
      - main  # Cambia a tu rama principal si es diferente

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    # Checkout del repositorio
    - name: Checkout code
      uses: actions/checkout@v3

    # Configuraci√≥n de Docker Buildx
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2

    # Cache de capas de Docker para acelerar las compilaciones
    - name: Cache Docker layers
      uses: actions/cache@v3
      with:
        path: /tmp/.buildx-cache
        key: ${{ runner.os }}-buildx-${{ github.sha }}
        restore-keys: |
          ${{ runner.os }}-buildx-

    # Construir la imagen Docker
    - name: Build Docker image
      run: |
        docker build -t my-image .

    # Subir la imagen Docker a un registro (DockerHub, GitHub Container Registry, etc.)
    - name: Push Docker image
      run: |
        docker push my-image

  ftp_deploy:
    runs-on: ubuntu-latest
    needs: deploy  # Asegura que este paso solo se ejecute si el paso de deploy (Docker build) fue exitoso

    steps:
    # Checkout del repositorio
    - name: Checkout code
      uses: actions/checkout@v3

    # Instalar lftp para realizar la transferencia FTP
    - name: Install FTP Client
      run: sudo apt-get install -y lftp

    # Transferir archivos mediante FTP
    - name: Transfer files via FTP
      uses: ercindedeoglu/ftp-transfer-action@v2
      with:
        host: ${{ secrets.FTP_HOST }}
        user: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        source: './local_directory/'  # Cambia a la ruta de los archivos que quieras transferir
        destination: '/public_html/projectci/'
        forceSSL: true
        options: "--delete --verbose"










   


 



    
    

       


     


