name: Deploy to Hostinger via FTP

on:
  push:
    branches:
      - main
      - staging

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Checkout the code from the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # Install lftp (an FTP client)
      - name: Install lftp
        run: sudo apt-get install -y lftp

      # Upload files to the server
      - name: Deploy to FTP
        env:
          FTP_HOST: ${{ secrets.FTP_HOST }}
          FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
          FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
        run: |
          if [ "${{ github.ref_name }}" == "main" ]; then
            TARGET_PATH="/public_html/projectci/main/"
          elif [ "${{ github.ref_name }}" == "staging" ]; then
            TARGET_PATH="/public_html/projectci/staging/"
          else
            echo "Unknown branch. Skipping deployment."
            exit 0
          fi
          
          lftp -u $FTP_USERNAME,$FTP_PASSWORD $FTP_HOST <<EOF
          mirror -R ./ $TARGET_PATH
          bye
          EOF

     


